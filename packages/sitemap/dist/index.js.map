{"version":3,"sources":["../src/robots.ts","../src/utils.ts","../src/index.ts"],"names":["fs","path","outDir"],"mappings":"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","file":"index.js","sourcesContent":["export const DEFAULT_ROBOTS_TXT = `User-agent: *\nAllow: /\nDisallow: /admin\nDisallow: /api/\n`;\n\n/**\n * Generates robots.txt string referencing sitemap.xml or custom sitemaps as needed.\n * @param indexUrl Fully-qualified URL for the produced sitemap.xml\n * @returns Standard robots.txt content\n */\nexport function createRobotsTxt(indexUrl: string): string {\n\tif (!indexUrl || typeof indexUrl !== \"string\") {\n\t\tthrow new Error(\"createRobotsTxt: indexUrl must be a non-empty string\");\n\t}\n\treturn `User-agent: *\\nAllow: /\\nDisallow: /admin\\nDisallow: /api/\\nSitemap: ${indexUrl}\\n`;\n}\n","import fs from \"node:fs\";\nimport path from \"node:path\";\nimport type { LocaleConfig, SitemapEntry } from \"./types\";\n\n/**\n * Minifies XML by removing unnecessary whitespace.\n * Lightweight alternative to heavy minification libraries.\n */\nfunction minifyXml(xml: string): string {\n\treturn xml\n\t\t.replace(/>\\s+</g, \"><\") // Remove whitespace between tags\n\t\t.replace(/\\s{2,}/g, \" \") // Collapse multiple spaces\n\t\t.trim();\n}\n\n/**\n * Generates a localized URL based on the locale mode.\n * @param baseUrl - The base URL (e.g., '/about')\n * @param locale - The locale configuration\n * @param domain - The domain (e.g., 'https://example.com')\n * @param localeMode - How to format the URL ('prefix' or 'subdomain')\n */\nexport function localizeUrl(\n\tbaseUrl: string,\n\tlocale: LocaleConfig,\n\tdomain: string,\n\tlocaleMode: \"prefix\" | \"subdomain\" = \"prefix\",\n): string {\n\t// Default locale doesn't get modified\n\tif (locale.default) {\n\t\treturn domain + baseUrl;\n\t}\n\n\tif (localeMode === \"subdomain\") {\n\t\t// Remove protocol and www for subdomain handling\n\t\tconst urlObj = new URL(domain);\n\t\tconst hostname = urlObj.hostname.replace(/^www\\./, \"\");\n\t\tconst subdomain = `${locale.code}.${hostname}`;\n\t\treturn `${urlObj.protocol}//${subdomain}${urlObj.port ? `:${urlObj.port}` : \"\"}${baseUrl}`;\n\t}\n\n\t// Prefix mode: add locale to path\n\tconst prefix = `/${locale.code}`;\n\treturn domain + prefix + baseUrl;\n}\n\n/**\n * Internal type for sitemap entry with locale alternates\n */\ntype SitemapEntryWithAlternates = SitemapEntry & {\n\talternates?: { hreflang: string; href: string }[];\n};\n\n/**\n * Generates a sitemap.xml string from a list of SitemapEntry objects.\n * Optionally minifies the output with minify-xml if opts.minify is true.\n * Throws an Error if minify or generation fails.\n */\nexport async function createSitemapXml(\n\turls: SitemapEntryWithAlternates[],\n\topts?: { minify?: boolean },\n): Promise<string> {\n\ttry {\n\t\tconst now = new Date().toISOString();\n\t\tlet imageNS = false;\n\t\tlet videoNS = false;\n\t\tlet xhtmlNS = false;\n\n\t\tconst items: string = urls\n\t\t\t.map((u) => {\n\t\t\t\tlet xml = `<url><loc>${u.url}</loc><lastmod>${u.lastmod ?? now}</lastmod>`;\n\t\t\t\tif (u.changefreq) {\n\t\t\t\t\txml += `<changefreq>${u.changefreq}</changefreq>`;\n\t\t\t\t}\n\t\t\t\tif (typeof u.priority === \"number\") {\n\t\t\t\t\txml += `<priority>${u.priority.toFixed(1)}</priority>`;\n\t\t\t\t}\n\t\t\t\tif (u.alternates?.length) {\n\t\t\t\t\txhtmlNS = true;\n\t\t\t\t\tfor (const alt of u.alternates) {\n\t\t\t\t\t\txml += `<xhtml:link rel=\"alternate\" hreflang=\"${alt.hreflang}\" href=\"${alt.href}\" />`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (u.imageUrls?.length) {\n\t\t\t\t\timageNS = true;\n\t\t\t\t\tfor (const img of u.imageUrls) {\n\t\t\t\t\t\txml += `<image:image><image:loc>${img}</image:loc></image:image>`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (u.videoUrls?.length) {\n\t\t\t\t\tvideoNS = true;\n\t\t\t\t\tfor (const vid of u.videoUrls) {\n\t\t\t\t\t\txml += `<video:video><video:content_loc>${vid}</video:content_loc></video:video>`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\txml += \"</url>\";\n\t\t\t\treturn xml;\n\t\t\t})\n\t\t\t.join(\"\");\n\t\tconst ns: string = [\n\t\t\t'xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\"',\n\t\t\txhtmlNS ? 'xmlns:xhtml=\"http://www.w3.org/1999/xhtml\"' : null,\n\t\t\timageNS\n\t\t\t\t? 'xmlns:image=\"http://www.google.com/schemas/sitemap-image/1.1\"'\n\t\t\t\t: null,\n\t\t\tvideoNS\n\t\t\t\t? 'xmlns:video=\"http://www.google.com/schemas/sitemap-video/1.1\"'\n\t\t\t\t: null,\n\t\t]\n\t\t\t.filter(Boolean)\n\t\t\t.join(\" \");\n\t\tlet xmlString = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\\n<urlset ${ns}>${items}</urlset>`;\n\t\tif (opts?.minify) {\n\t\t\txmlString = minifyXml(xmlString);\n\t\t}\n\t\treturn xmlString;\n\t} catch (err) {\n\t\tthrow new Error(\n\t\t\t`Sitemap XML creation failed: ${err instanceof Error ? err.message : String(err)}`,\n\t\t);\n\t}\n}\n\n/**\n * Generates a sitemapindex XML string for an array of sitemap file urls.\n * Throws an Error if minify or generation fails.\n */\nexport async function createIndexSitemap(\n\tfiles: string[],\n\tbaseUrl: string,\n\topts?: { minify?: boolean },\n): Promise<string> {\n\ttry {\n\t\tconst items: string = files\n\t\t\t.map((f) => `<sitemap><loc>${baseUrl}/${f}</loc></sitemap>`)\n\t\t\t.join(\"\");\n\t\tlet xmlString = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\\n<sitemapindex xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">${items}</sitemapindex>`;\n\t\tif (opts?.minify) {\n\t\t\txmlString = minifyXml(xmlString);\n\t\t}\n\t\treturn xmlString;\n\t} catch (err) {\n\t\tthrow new Error(\n\t\t\t`Sitemap index XML creation failed: ${err instanceof Error ? err.message : String(err)}`,\n\t\t);\n\t}\n}\n\n/**\n * Writes a file to a directory, creating the full path if needed. Throws on failure.\n */\nexport const createFile = (\n\toutputPath: string,\n\tfilename: string,\n\tcontent: string,\n): void => {\n\ttry {\n\t\tfs.writeFileSync(path.join(outputPath, filename), content);\n\t} catch (err) {\n\t\tthrow new Error(\n\t\t\t`Failed to write file ${filename} to ${outputPath}: ${err instanceof Error ? err.message : String(err)}`,\n\t\t);\n\t}\n};\n\n/**\n * Generates localized versions of sitemap entries.\n * Creates one entry per locale with hreflang alternates.\n */\nexport function generateLocalizedEntries(\n\tbaseEntries: SitemapEntry[],\n\tlocales: LocaleConfig[],\n\tdomain: string,\n\tlocaleMode: \"prefix\" | \"subdomain\" = \"prefix\",\n): SitemapEntryWithAlternates[] {\n\tconst localizedEntries: SitemapEntryWithAlternates[] = [];\n\tconst defaultLocale = locales.find((l) => l.default);\n\n\tfor (const entry of baseEntries) {\n\t\t// Skip localization if requested\n\t\tif (entry.skipLocalization) {\n\t\t\tlocalizedEntries.push({\n\t\t\t\t...entry,\n\t\t\t\turl: domain + entry.url,\n\t\t\t});\n\t\t\tcontinue;\n\t\t}\n\n\t\t// Generate alternates for this entry\n\t\tconst alternates = locales.map((locale) => ({\n\t\t\threflang: locale.code,\n\t\t\thref: localizeUrl(entry.url, locale, domain, localeMode),\n\t\t}));\n\n\t\t// Add x-default pointing to the default locale (or first if no default set)\n\t\tconst xDefaultLocale = defaultLocale || locales[0];\n\t\tif (xDefaultLocale) {\n\t\t\talternates.push({\n\t\t\t\threflang: \"x-default\",\n\t\t\t\thref: localizeUrl(entry.url, xDefaultLocale, domain, localeMode),\n\t\t\t});\n\t\t}\n\n\t\t// Create an entry for each locale\n\t\tfor (const locale of locales) {\n\t\t\tlocalizedEntries.push({\n\t\t\t\t...entry,\n\t\t\t\turl: localizeUrl(entry.url, locale, domain, localeMode),\n\t\t\t\talternates,\n\t\t\t});\n\t\t}\n\t}\n\n\treturn localizedEntries;\n}\n","import fs from \"node:fs\";\nimport path from \"node:path\";\nimport { DEFAULT_ROBOTS_TXT } from \"./robots\";\nimport type { LocaleConfig, SitemapConfig, SitemapEntry } from \"./types\";\nimport {\n\tcreateFile,\n\tcreateIndexSitemap,\n\tcreateSitemapXml,\n\tgenerateLocalizedEntries,\n} from \"./utils\";\n\n// Export types for consumers\nexport type { LocaleConfig, SitemapConfig, SitemapEntry };\n\nconst DEFAULT_CONFIG: SitemapConfig = {\n\tdomain: \"https://yoursite.com\",\n\toutDir: \"dist\",\n\tdisableMinification: false,\n\tsitemaps: { pages: async () => [] },\n\trobots: async () => DEFAULT_ROBOTS_TXT,\n};\n\nexport default function crawlMeMaybeSitemap(\n\tconfig: SitemapConfig = DEFAULT_CONFIG,\n) {\n\tconst domain = config?.domain;\n\tif (!domain) {\n\t\tthrow new Error(\n\t\t\t\"⚠️ No domain provided. Sitemap generation requires a domain.\",\n\t\t);\n\t}\n\n\tconst outDir = config?.outDir || \"dist\";\n\tconst minify = !config?.disableMinification;\n\tconst locales = config?.locales;\n\tconst localeMode = config?.localeMode || \"prefix\";\n\n\t/**\n\t * Creates robots.txt handling custom async/user rules and always adds sitemaps at the end.\n\t * @param sitemapsUrls - array of string (relative to domain)\n\t */\n\tconst createRobots = async (sitemapsUrls: string[] = [\"/sitemap.xml\"]) => {\n\t\tlet userRobots = DEFAULT_ROBOTS_TXT;\n\t\tif (config.robots && typeof config.robots === \"function\") {\n\t\t\ttry {\n\t\t\t\tconst result = await config.robots();\n\t\t\t\tif (typeof result === \"string\") {\n\t\t\t\t\tuserRobots = result;\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tconsole.warn(\"[SEO] Error in user robots async callback\", err);\n\t\t\t}\n\t\t}\n\t\tlet content = userRobots.trim();\n\t\tif (!content.endsWith(\"\\n\")) content += \"\\n\";\n\t\t// Ensure no duplicate Sitemap: lines\n\t\tconst domainUrl = domain.endsWith(\"/\") ? domain.slice(0, -1) : domain;\n\t\tfor (const rel of sitemapsUrls) {\n\t\t\tcontent += `Sitemap: ${domainUrl}${rel.startsWith(\"/\") ? rel : `${\"/\"}${rel}`}\\n`;\n\t\t}\n\t\tcreateFile(outDir, \"robots.txt\", content);\n\t};\n\n\tconst createSitemap = async (filename: string, urls: SitemapEntry[]) => {\n\t\t// Apply localization if configured\n\t\tconst processedUrls =\n\t\t\tlocales && locales.length > 0\n\t\t\t\t? generateLocalizedEntries(urls, locales, domain, localeMode)\n\t\t\t\t: urls.map((u) => ({ ...u, url: domain + u.url }));\n\n\t\tconst xml = await createSitemapXml(processedUrls, { minify });\n\t\tcreateFile(outDir, filename, xml);\n\t};\n\n\treturn {\n\t\tname: \"vite-plugin-sitemap\",\n\t\tapply: \"build\" as const,\n\t\tasync closeBundle() {\n\t\t\tconst outDir = path.resolve(process.cwd(), config?.outDir || \"dist\");\n\t\t\tfs.mkdirSync(outDir, { recursive: true });\n\t\t\tconst { sitemaps } = config;\n\n\t\t\tif (typeof sitemaps === \"function\") {\n\t\t\t\t// Single sitemap mode\n\t\t\t\tconst urls = await sitemaps();\n\t\t\t\tawait createSitemap(\"sitemap.xml\", urls);\n\t\t\t\tawait createRobots([\"/sitemap.xml\"]);\n\t\t\t\tconsole.log(\"✅ Generated single sitemap\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Multi-sitemap mode (object)\n\t\t\tconst allSitemaps: string[] = [];\n\t\t\tfor (const [name, cb] of Object.entries(sitemaps)) {\n\t\t\t\tif (typeof cb !== \"function\") continue;\n\t\t\t\tconst urls = await cb();\n\t\t\t\tawait createSitemap(`sitemap-${name}.xml`, urls);\n\t\t\t\tallSitemaps.push(`/sitemap-${name}.xml`);\n\t\t\t}\n\n\t\t\tconst indexXml = await createIndexSitemap(\n\t\t\t\tallSitemaps.map((s: string) => s.slice(1)),\n\t\t\t\tdomain,\n\t\t\t\t{ minify },\n\t\t\t);\n\t\t\tcreateFile(outDir, \"sitemap.xml\", indexXml);\n\t\t\tawait createRobots([\"/sitemap.xml\"]);\n\t\t\tconsole.log(\n\t\t\t\t`✅ Generated ${allSitemaps.length} sitemaps + index + robots.txt`,\n\t\t\t);\n\t\t},\n\t};\n}\n"]}