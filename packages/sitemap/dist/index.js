import t from"fs";import e from"path";var o="User-agent: *\nAllow: /\nDisallow: /admin\nDisallow: /api/\n";function i(t){return t.replace(/>\s+</g,"><").replace(/\s{2,}/g," ").trim()}function n(t,e,o,i="prefix",n=!1){const r=t?.startsWith("/")?t:`/${t||""}`;if(e.default&&!n)return o+r;if("subdomain"===i){const t=new URL(o),i=t.hostname.replace(/^www\./,""),n=`${e.code}.${i}`;return`${t.protocol}//${n}${t.port?`:${t.port}`:""}${r}`}return o+`/${e.code}`+r}var r=(o,i,n)=>{try{t.writeFileSync(e.join(o,i),n)}catch(t){throw new Error(`Failed to write file ${i} to ${o}: ${t instanceof Error?t.message:String(t)}`)}};var a={domain:"https://yoursite.com",outDir:"dist",disableMinification:!1,sitemaps:{pages:async()=>[]},robots:async()=>o};function s(s=a){const l=s||a,c=l?.domain;if(!c)throw new Error("⚠️ No domain provided. Sitemap generation requires a domain.");const m=l?.outDir||"dist",f=e.resolve(process.cwd(),m),p=!l?.disableMinification,u=l?.locales,d=l?.localeMode||"prefix",g=l?.prefixDefault??!1,h=async(t=["/sitemap.xml"])=>{let e=o;if(l.robots&&"function"==typeof l.robots)try{const t=await l.robots();"string"==typeof t&&(e=t)}catch(t){console.warn("[SEO] Error in user robots async callback",t)}let i=e.trim();i.endsWith("\n")||(i+="\n");const n=c.endsWith("/")?c.slice(0,-1):c;for(const e of t)i+=`Sitemap: ${n}${e.startsWith("/")?e:`/${e}`}\n`;r(f,"robots.txt",i)},w=async(t,e)=>{const o=u&&u.length>0?function(t,e,o,i="prefix",r=!1){const a=[],s=e.find(t=>t.default);for(const l of t){if(l.skipLocalization){a.push({...l,url:o+l.url});continue}const t=e.map(t=>({hreflang:t.code,href:n(l.url,t,o,i,r)})),c=s||e[0];c&&t.push({hreflang:"x-default",href:n(l.url,c,o,i,r)});for(const s of e)a.push({...l,url:n(l.url,s,o,i,r),alternates:t})}return a}(e,u,c,d,g):e.map(t=>{const e=t.url?.startsWith("/")?t.url:`/${t.url||""}`;return{...t,url:c+e}}),a=await async function(t,e){try{const o=(new Date).toISOString();let n=!1,r=!1,a=!1;const s=t.map(t=>{let e=`<url><loc>${t.url}</loc><lastmod>${t.lastmod??o}</lastmod>`;if(t.changefreq&&(e+=`<changefreq>${t.changefreq}</changefreq>`),"number"==typeof t.priority&&(e+=`<priority>${t.priority.toFixed(1)}</priority>`),t.alternates?.length){a=!0;for(const o of t.alternates)e+=`<xhtml:link rel="alternate" hreflang="${o.hreflang}" href="${o.href}" />`}if(t.imageUrls?.length){n=!0;for(const o of t.imageUrls)e+=`<image:image><image:loc>${o}</image:loc></image:image>`}if(t.videoUrls?.length){r=!0;for(const o of t.videoUrls)e+=`<video:video><video:content_loc>${o}</video:content_loc></video:video>`}return e+="</url>",e}).join("");let l=`<?xml version="1.0" encoding="UTF-8"?>\n<urlset ${['xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"',a?'xmlns:xhtml="http://www.w3.org/1999/xhtml"':null,n?'xmlns:image="http://www.google.com/schemas/sitemap-image/1.1"':null,r?'xmlns:video="http://www.google.com/schemas/sitemap-video/1.1"':null].filter(Boolean).join(" ")}>${s}</urlset>`;return e?.minify&&(l=i(l)),l}catch(t){throw new Error(`Sitemap XML creation failed: ${t instanceof Error?t.message:String(t)}`)}}(o,{minify:p});r(f,t,a)};return{name:"vite-plugin-sitemap",apply:"build",async closeBundle(){t.mkdirSync(f,{recursive:!0});const{sitemaps:e}=l;if(!e)return void console.warn("⚠️ No sitemaps configuration found");if("function"==typeof e){const t=await e();return await w("sitemap.xml",t),await h(["/sitemap.xml"]),void console.log("✅ Generated single sitemap")}const o=[];for(const[t,i]of Object.entries(e)){if("function"!=typeof i)continue;const e=await i();await w(`sitemap-${t}.xml`,e),o.push(`/sitemap-${t}.xml`)}const n=await async function(t,e,o){try{let n=`<?xml version="1.0" encoding="UTF-8"?>\n<sitemapindex xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">${t.map(t=>`<sitemap><loc>${e}/${t}</loc></sitemap>`).join("")}</sitemapindex>`;return o?.minify&&(n=i(n)),n}catch(t){throw new Error(`Sitemap index XML creation failed: ${t instanceof Error?t.message:String(t)}`)}}(o.map(t=>t.slice(1)),c,{minify:p});r(f,"sitemap.xml",n),await h(["/sitemap.xml"]),console.log(`✅ Generated ${o.length} sitemaps + index + robots.txt`)}}}export{s as default};