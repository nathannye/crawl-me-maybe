"use strict";var e=require("fs"),t=require("path");function o(e){return e&&e.__esModule?e:{default:e}}var i=o(e),n=o(t),r="User-agent: *\nAllow: /\nDisallow: /admin\nDisallow: /api/\n";function a(e){return e.replace(/>\s+</g,"><").replace(/\s{2,}/g," ").trim()}function s(e,t,o,i="prefix",n=!1){const r=e?.startsWith("/")?e:`/${e||""}`;if(t.default&&!n)return o+r;if("subdomain"===i){const e=new URL(o),i=e.hostname.replace(/^www\./,""),n=`${t.code}.${i}`;return`${e.protocol}//${n}${e.port?`:${e.port}`:""}${r}`}return o+`/${t.code}`+r}var l=(e,t,o)=>{try{i.default.writeFileSync(n.default.join(e,t),o)}catch(o){throw new Error(`Failed to write file ${t} to ${e}: ${o instanceof Error?o.message:String(o)}`)}};var c={domain:"https://yoursite.com",outDir:"dist",disableMinification:!1,sitemaps:{pages:async()=>[]},robots:async()=>r};module.exports=function(e=c){const t=e||c,o=t?.domain;if(!o)throw new Error("⚠️ No domain provided. Sitemap generation requires a domain.");const m=t?.outDir||"dist",f=n.default.resolve(process.cwd(),m),u=!t?.disableMinification,p=t?.locales,d=t?.localeMode||"prefix",g=t?.prefixDefault??!1,h=async(e=["/sitemap.xml"])=>{let i=r;if(t.robots&&"function"==typeof t.robots)try{const e=await t.robots();"string"==typeof e&&(i=e)}catch(e){console.warn("[SEO] Error in user robots async callback",e)}let n=i.trim();n.endsWith("\n")||(n+="\n");const a=o.endsWith("/")?o.slice(0,-1):o;for(const t of e)n+=`Sitemap: ${a}${t.startsWith("/")?t:`/${t}`}\n`;l(f,"robots.txt",n)},w=async(e,t)=>{const i=p&&p.length>0?function(e,t,o,i="prefix",n=!1){const r=[],a=t.find(e=>e.default);for(const l of e){if(l.skipLocalization){r.push({...l,url:o+l.url});continue}const e=t.map(e=>({hreflang:e.code,href:s(l.url,e,o,i,n)})),c=a||t[0];c&&e.push({hreflang:"x-default",href:s(l.url,c,o,i,n)});for(const a of t)r.push({...l,url:s(l.url,a,o,i,n),alternates:e})}return r}(t,p,o,d,g):t.map(e=>{const t=e.url?.startsWith("/")?e.url:`/${e.url||""}`;return{...e,url:o+t}}),n=await async function(e,t){try{const o=(new Date).toISOString();let i=!1,n=!1,r=!1;const s=e.map(e=>{let t=`<url><loc>${e.url}</loc><lastmod>${e.lastmod??o}</lastmod>`;if(e.changefreq&&(t+=`<changefreq>${e.changefreq}</changefreq>`),"number"==typeof e.priority&&(t+=`<priority>${e.priority.toFixed(1)}</priority>`),e.alternates?.length){r=!0;for(const o of e.alternates)t+=`<xhtml:link rel="alternate" hreflang="${o.hreflang}" href="${o.href}" />`}if(e.imageUrls?.length){i=!0;for(const o of e.imageUrls)t+=`<image:image><image:loc>${o}</image:loc></image:image>`}if(e.videoUrls?.length){n=!0;for(const o of e.videoUrls)t+=`<video:video><video:content_loc>${o}</video:content_loc></video:video>`}return t+="</url>",t}).join("");let l=`<?xml version="1.0" encoding="UTF-8"?>\n<urlset ${['xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"',r?'xmlns:xhtml="http://www.w3.org/1999/xhtml"':null,i?'xmlns:image="http://www.google.com/schemas/sitemap-image/1.1"':null,n?'xmlns:video="http://www.google.com/schemas/sitemap-video/1.1"':null].filter(Boolean).join(" ")}>${s}</urlset>`;return t?.minify&&(l=a(l)),l}catch(e){throw new Error(`Sitemap XML creation failed: ${e instanceof Error?e.message:String(e)}`)}}(i,{minify:u});l(f,e,n)};return{name:"vite-plugin-sitemap",apply:"build",async closeBundle(){i.default.mkdirSync(f,{recursive:!0});const{sitemaps:e}=t;if(!e)return void console.warn("⚠️ No sitemaps configuration found");if("function"==typeof e){const t=await e();return await w("sitemap.xml",t),await h(["/sitemap.xml"]),void console.log("✅ Generated single sitemap")}const n=[];for(const[t,o]of Object.entries(e)){if("function"!=typeof o)continue;const e=await o();await w(`sitemap-${t}.xml`,e),n.push(`/sitemap-${t}.xml`)}const r=await async function(e,t,o){try{let i=`<?xml version="1.0" encoding="UTF-8"?>\n<sitemapindex xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">${e.map(e=>`<sitemap><loc>${t}/${e}</loc></sitemap>`).join("")}</sitemapindex>`;return o?.minify&&(i=a(i)),i}catch(e){throw new Error(`Sitemap index XML creation failed: ${e instanceof Error?e.message:String(e)}`)}}(n.map(e=>e.slice(1)),o,{minify:u});l(f,"sitemap.xml",r),await h(["/sitemap.xml"]),console.log(`✅ Generated ${n.length} sitemaps + index + robots.txt`)}}};