"use strict";var t=require("fs"),e=require("path");function o(t){return t&&t.__esModule?t:{default:t}}var i=o(t),n=o(e),r="User-agent: *\nAllow: /\nDisallow: /admin\nDisallow: /api/\n";function a(t){return t.replace(/>\s+</g,"><").replace(/\s{2,}/g," ").trim()}function s(t,e,o,i="prefix"){const n=t?.startsWith("/")?t:`/${t||""}`;if(e.default)return o+n;if("subdomain"===i){const t=new URL(o),i=t.hostname.replace(/^www\./,""),r=`${e.code}.${i}`;return`${t.protocol}//${r}${t.port?`:${t.port}`:""}${n}`}return o+`/${e.code}`+n}var l=(t,e,o)=>{try{i.default.writeFileSync(n.default.join(t,e),o)}catch(o){throw new Error(`Failed to write file ${e} to ${t}: ${o instanceof Error?o.message:String(o)}`)}};var c={domain:"https://yoursite.com",outDir:"dist",disableMinification:!1,sitemaps:{pages:async()=>[]},robots:async()=>r};module.exports=function(t=c){const e=t||c,o=e?.domain;if(!o)throw new Error("⚠️ No domain provided. Sitemap generation requires a domain.");const m=e?.outDir||"dist",f=!e?.disableMinification,u=e?.locales,p=e?.localeMode||"prefix",d=async(t=["/sitemap.xml"])=>{let i=r;if(e.robots&&"function"==typeof e.robots)try{const t=await e.robots();"string"==typeof t&&(i=t)}catch(t){console.warn("[SEO] Error in user robots async callback",t)}let n=i.trim();n.endsWith("\n")||(n+="\n");const a=o.endsWith("/")?o.slice(0,-1):o;for(const e of t)n+=`Sitemap: ${a}${e.startsWith("/")?e:`/${e}`}\n`;l(m,"robots.txt",n)},g=async(t,e)=>{const i=u&&u.length>0?function(t,e,o,i="prefix"){const n=[],r=e.find(t=>t.default);for(const a of t){if(a.skipLocalization){n.push({...a,url:o+a.url});continue}const t=e.map(t=>({hreflang:t.code,href:s(a.url,t,o,i)})),l=r||e[0];l&&t.push({hreflang:"x-default",href:s(a.url,l,o,i)});for(const r of e)n.push({...a,url:s(a.url,r,o,i),alternates:t})}return n}(e,u,o,p):e.map(t=>{const e=t.url?.startsWith("/")?t.url:`/${t.url||""}`;return{...t,url:o+e}}),n=await async function(t,e){try{const o=(new Date).toISOString();let i=!1,n=!1,r=!1;const s=t.map(t=>{let e=`<url><loc>${t.url}</loc><lastmod>${t.lastmod??o}</lastmod>`;if(t.changefreq&&(e+=`<changefreq>${t.changefreq}</changefreq>`),"number"==typeof t.priority&&(e+=`<priority>${t.priority.toFixed(1)}</priority>`),t.alternates?.length){r=!0;for(const o of t.alternates)e+=`<xhtml:link rel="alternate" hreflang="${o.hreflang}" href="${o.href}" />`}if(t.imageUrls?.length){i=!0;for(const o of t.imageUrls)e+=`<image:image><image:loc>${o}</image:loc></image:image>`}if(t.videoUrls?.length){n=!0;for(const o of t.videoUrls)e+=`<video:video><video:content_loc>${o}</video:content_loc></video:video>`}return e+="</url>",e}).join("");let l=`<?xml version="1.0" encoding="UTF-8"?>\n<urlset ${['xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"',r?'xmlns:xhtml="http://www.w3.org/1999/xhtml"':null,i?'xmlns:image="http://www.google.com/schemas/sitemap-image/1.1"':null,n?'xmlns:video="http://www.google.com/schemas/sitemap-video/1.1"':null].filter(Boolean).join(" ")}>${s}</urlset>`;return e?.minify&&(l=a(l)),l}catch(t){throw new Error(`Sitemap XML creation failed: ${t instanceof Error?t.message:String(t)}`)}}(i,{minify:f});l(m,t,n)};return{name:"vite-plugin-sitemap",apply:"build",async closeBundle(){const e=t||c,r=n.default.resolve(process.cwd(),e?.outDir||"dist");i.default.mkdirSync(r,{recursive:!0});const{sitemaps:s}=e;if("function"==typeof s){const t=await s();return await g("sitemap.xml",t),await d(["/sitemap.xml"]),void console.log("✅ Generated single sitemap")}const m=[];for(const[t,e]of Object.entries(s)){if("function"!=typeof e)continue;const o=await e();await g(`sitemap-${t}.xml`,o),m.push(`/sitemap-${t}.xml`)}const u=await async function(t,e,o){try{let i=`<?xml version="1.0" encoding="UTF-8"?>\n<sitemapindex xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">${t.map(t=>`<sitemap><loc>${e}/${t}</loc></sitemap>`).join("")}</sitemapindex>`;return o?.minify&&(i=a(i)),i}catch(t){throw new Error(`Sitemap index XML creation failed: ${t instanceof Error?t.message:String(t)}`)}}(m.map(t=>t.slice(1)),o,{minify:f});l(r,"sitemap.xml",u),await d(["/sitemap.xml"]),console.log(`✅ Generated ${m.length} sitemaps + index + robots.txt`)}}};